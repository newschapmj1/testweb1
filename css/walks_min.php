<!DOCTYPE html>
<html manifest="example.appcache">
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <!--<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css"> -->

    <link rel="stylesheet" href="css/custom002.css" type="text/css"/>
    <link href='http://fonts.googleapis.com/css?family=Merriweather:400,900|Open+Sans' rel='stylesheet' type='text/css'>
    <style>
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}nav{display:block}a{background:transparent}b{font-weight:bold}button{color:inherit;font:inherit;margin:0}button{overflow:visible}button{text-transform:none}button{-webkit-appearance:button;cursor:pointer}button::-moz-focus-inner{border:0;padding:0}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*:before,*:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}button{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#428bca;text-decoration:none}.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}h2{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}h2{margin-top:20px;margin-bottom:10px}h2{font-size:30px}p{margin:0 0 10px}.text-center{text-align:center}ul{margin-top:0;margin-bottom:10px}ul ul{margin-bottom:0} .col-sm-8, .col-md-8{position:relative;min-height:1px;padding-left:15px;padding-right:15px}@media (min-width:768px){ .col-sm-8{float:left}.col-sm-8{width:66.66666667%}.col-sm-offset-2{margin-left:16.66666667%}}@media (min-width:992px){ .col-md-8{float:left}.col-md-8{width:66.66666667%}.col-md-offset-2{margin-left:16.66666667%}}table{background-color:transparent}th{text-align:left}.table{width:100%;max-width:100%;margin-bottom:20px}.table>thead>tr>th,.table>tbody>tr>td{padding:8px;line-height:1.42857143;vertical-align:top;border-top:1px solid #ddd}.table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.table>thead:first-child>tr:first-child>th{border-top:0}@media screen and (max-width:767px){.table-responsive{width:100%;margin-bottom:15px;overflow-y:hidden;overflow-x:auto;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd;-webkit-overflow-scrolling:touch}}.caret{display:inline-block;width:0;height:0;margin-left:2px;vertical-align:middle;border-top:4px solid;border-right:4px solid transparent;border-left:4px solid transparent}.dropdown{position:relative}.dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:160px;padding:5px 0;margin:2px 0 0;list-style:none;font-size:14px;text-align:left;background-color:#fff;border:1px solid #ccc;border:1px solid rgba(0,0,0,0.15);border-radius:4px;-webkit-box-shadow:0 6px 12px rgba(0,0,0,0.175);box-shadow:0 6px 12px rgba(0,0,0,0.175);background-clip:padding-box}.dropdown-menu>li>a{display:block;padding:3px 20px;clear:both;font-weight:normal;line-height:1.42857143;color:#333;white-space:nowrap}.nav{margin-bottom:0;padding-left:0;list-style:none}.nav>li{position:relative;display:block}.nav>li>a{position:relative;display:block;padding:10px 15px}.navbar{position:relative;min-height:50px;margin-bottom:20px;border:1px solid transparent}@media (min-width:768px){.navbar{border-radius:4px}}@media (min-width:768px){.navbar-header{float:left}}.navbar-collapse{overflow-x:visible;padding-right:15px;padding-left:15px;border-top:1px solid transparent;box-shadow:inset 0 1px 0 rgba(255,255,255,0.1);-webkit-overflow-scrolling:touch}@media (min-width:768px){.navbar-collapse{width:auto;border-top:0;box-shadow:none}.navbar-collapse.collapse{display:block !important;height:auto !important;padding-bottom:0;overflow:visible !important}}.navbar-toggle{position:relative;float:right;margin-right:15px;padding:9px 10px;margin-top:8px;margin-bottom:8px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:4px}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:4px}@media (min-width:768px){.navbar-toggle{display:none}}.navbar-nav{margin:7.5px -15px}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:20px}@media (min-width:768px){.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:15px;padding-bottom:15px}}.navbar-nav>li>.dropdown-menu{margin-top:0;border-top-right-radius:0;border-top-left-radius:0}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-nav>li>a{color:#777}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse{border-color:#e7e7e7}.nav:before,.nav:after,.navbar:before,.navbar:after,.navbar-header:before,.navbar-header:after,.navbar-collapse:before,.navbar-collapse:after{content:" ";display:table}.nav:after,.navbar:after,.navbar-header:after,.navbar-collapse:after{clear:both}
</style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> 
    <!-- Include all compiled plugins (below), or include individual files as needed -->

    <!-- <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script> -->
<script src="js/bootstrap/3.2.0/bootstrap.min.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/favicon.ico"/>



<title>Redbridge Ramblers, Walks Programme</title>

</head>
<body>
<?php
include 'analyticstracking.php';
?>
 <?php
include 'navbar.php';
?>

<div id="logo003">
    <span class="redcolor text-centre">R</span>edbridge <span class="redcolor">R</span>amblers
 </div>
 <h2 class="text-center"><b>Walks Programme</b></h2>
<div class="col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2">

      <p>Please note that while we usually are able to provide a lift to the start of a walk, this can never be guaranteed as it entirely depends on our members being   able to call at the pick-up point with a spare seat in their car.
      <br><br>For Ramblers getting to walks by public transport please check <a href="http://www.traveline.info">Traveline</a>, <a href="http://www.tfl.gov.uk">TFL</a> (London area) &amp; <a href="https://maps.google.co.uk/">Google directions</a> (not all of the UK)<br>
        Click grid reference for a map (opens in new window). 
    </p>

<!--table-hover -->

<table class="table table-hover table-responsive">
  <thead>
  <tr>
    <th>Date</th>
    <th>Details</th>
    <th>Map</th>
    <th>Description</th>
  </tr>
</thead>
  

<?php
                include("functions.php");
#copied Multimap settings from walkstest.php
#removed references to Streetview which were out of date
#John Chapman 
#Date 14 Jun 2009
#Other minor syntax changes to suppress warning messages
#=========================
#V1.1
#Date 24 Jan 2010
#use of table padding to make table more readable
#
#V1.2 
#Date 11 April 2010
#add full code description, link to Google maps
#
#V1.3 5 Nov 2013
#New bootstrap layout

        //Variables for connecting to your database.
            //These variable values come from your hosting account.

            $hostname = "walkerS1.db.10868745.hostedresource.com";
            $username = "walkerS1";
            $dbname = "walkerS1";

            //These variable values need to be changed by you before deploying
            $password = "W2LzTL8d!";
            $usertable = "walks2_jul_2014";
            $yourfield = "your_field";

/*
            $hostname = "localhost";
            $username = "root";
            $dbname = "walkerS1";

            //These variable values need to be changed by you before deploying
            $password = "redbridge";
            $usertable = "walks2_dec_2013";
*/



try {
    $dbh = new PDO("mysql:host=$hostname;dbname=$dbname", $username, $password);
    /*** echo a message saying we have connected ***/
           
                $query="SELECT walkdate,briefdescription,exp,startgridref,starttime,grade,longerdescription, miles,lon,lat
                  FROM $usertable
		where walkdate>=date(now())-1
		order by walkdate";
        
                $oldmonth="";

  foreach ($dbh->query($query) as $row)
        {
                        $d=formatday($row['walkdate']);
                        $m=formatmonth($row['walkdate']);
                        $y=formatyear($row['walkdate']);

                        //-------------make unix timestamp for formatting---------------------
                        $timestamp=mktime(0,0,0,substr($row['walkdate'],5,2),substr($row['walkdate'],8,2),substr($row['walkdate'],0,4));
                        $formatteddate=date("F Y",$timestamp);
                        
                        //---------------if month changes, add a new row----------------
                        if ($oldmonth!=$m)
                                {
                                        print("<tr> <td colspan=\"4\"><b>$formatteddate</b></td>    </tr>");
                                }
                        $oldmonth=$m;
                                                
                       
						//$formatteddate=date("l jS ",$timestamp)." of ".date("F",$timestamp);
						$formatteddatetime=date("l",$timestamp)."<br>".date("jS",$timestamp)." of ".date("F",$timestamp)."<br>Time: ".$row[starttime];
                        
                        $year= substr($row['walkdate'],0,4);
                    $month=(substr($row['walkdate'],5,2));
                    $day= substr($row['walkdate'],8,2);
                    $walktime=mktime(1,1,1,$month,$day,$year);
                    $t=time();
                    $t2=time()-(24*20000);
                        if ($walktime<$t2) {$old="Old";} else {$old="Current";}
                        
                        //  for use later to make a clickable streetmap link
                        // e.g. http://www.streetmap.co.uk/streetmap.dll?G2M?X=440109&ampY=191498&amp;A=Y&Z=1
                        //http://streetmap.co.uk/grid/527383_174495
                        $easting=substr($row['startgridref'],3,3);
                        $northing=substr($row['startgridref'],6,3);
                        $gridsquare=substr($row['startgridref'],0,2);
                        $sqeast="5";
                        $sqnorth="1";
                        
                        //Change to Streetmap as Multimap worked on some machines not others, cause unknown.
                        if($gridsquare=="SZ") { ($sqeast="4"); ($sqnorth=""); }
                        if($gridsquare=="SU") { ($sqeast="4"); ($sqnorth="1"); }
                        if($gridsquare=="SP") { ($sqeast="4"); ($sqnorth="2"); }
                        if($gridsquare=="TV") { ($sqeast="5"); ($sqnorth=""); }         
                        if($gridsquare=="TQ") { ($sqeast="5"); ($sqnorth="1"); }                
                        if($gridsquare=="TL") { ($sqeast="5"); ($sqnorth="2"); }                
                        if($gridsquare=="TR") { ($sqeast="6"); ($sqnorth="1"); }                
                        if($gridsquare=="TM") { ($sqeast="6"); ($sqnorth="2"); }                
                        
                        $mapgridref=$sqeast.$easting."00_".$sqnorth.$northing."00_120";
                        
                        if ($old!="Old") 
                                {
								
									$startgridref = str_replace(" ","_",$row['startgridref']);

                                    print("<tr>");
									
									print("<td>$formatteddatetime");
									print("</td>");
									print("<td>$row[briefdescription]<br><br>Miles: $row[miles]<br><br>Grade: ".Walkcode($row['grade']));
									print("</td>");
									
									print("<td><a href=\"http://streetmap.co.uk/grid/$mapgridref\" target=\"_blank\" >$startgridref</a><br><br>");
										if ($row['lat'] <>"") {
										print("<a href=\"http://maps.google.co.uk/?q=".$row['lat'].",".$row['lon']
										."(See%20Description%20for%20departure%20details)&amp;z=16&amp;t=k\" target=\"_blank\">Satellite</a><br>");
										}
									
									
									print("<br>Map ".$row[exp]."</td>");
									print("<td>$row[longerdescription]&nbsp;");
									print("</td>");
									
									print("</tr>");
									

                                }
        }
/*** close database  ***/
		$dbh = null;		
    }  
 
catch(PDOException $e)
    {
    echo $e->getMessage();
    }        

 function Walkcode($walkcode) {
      switch ($walkcode)
	{
	  case 'E':$returnValue = 'Easy';
	  break;
	  case  'EA':$returnValue = 'Easy Access';
	  break;
	  case 'L':$returnValue = 'Leisurely';
	  break;
	  case 'M':$returnValue = 'Moderate';
	break;	  
	  case 'S':$returnValue = 'Strenuous';
		break;
	default:
		$returnValue='&nbsp;';
		break;	  
	}
      // do stuff
      return $returnValue;

};
	             
?>
</table>
</div>
<link rel="stylesheet" href="css/bootstrap/3.2.0/bootstrap.min.css"> 
</body>
</html>
